$('.sign-up-second-step').hide();jQuery(document).ready(function(e){var countInterval;var phone_number;var pre_counter_text='<i class="far fa-clock" aria-hidden="true"></i>&nbsp;00:';$(document).on('click','.arrow-signup',function(e){$(".sign-up-second-step").hide();$(".sign-up-first-step").show();$("#count").html(pre_counter_text+"30");if(countInterval!==false){clearInterval(countInterval);countInterval=false;}});$(document).on('click','#btnCounter',function(e){e.preventDefault();$("#btnCounterDisabled").css("display","inline-block");$("#btnCounter").css("display","none");$("#count").css('display','inline-block');$("#otp-generate").submit();});jQuery.validator.addMethod("itiValidNumber",function(value,element){return this.optional(element)||ITI_ALL2.isValidNumber();},"Please enter a valid  Phone Number");$("#otp-generate").validate({rules:{phone:{required:true,number:true,itiValidNumber:true,}},messages:{phone:{required:"Mobile number is required",number:"Please enter number only",}},submitHandler:function(form){phone_number=ITI_ALL2.getNumber();if(phone_number){start_full_loader();$.ajax({url:send_otp_url,type:'post',data:{'csrfmiddlewaretoken':$('#global-csrf-token').val(),'phone_number':phone_number.replace("+",""),'country_iso2_code':ITI_ALL2.getSelectedCountryData().iso2,},dataType:'json',success:function(data){stop_full_loader();if(data.status){$('.sign-up-first-step').hide();$('.sign-up-second-step').show();$("#pinId").val(data.pinId);$("#userId").val(data.user_id);$("#count").show();var counter=30;countInterval=setInterval(function(){--counter;if(counter>=0){var extra_zero="";if(counter<10){extra_zero="0";}
$("#count").html(pre_counter_text+extra_zero+counter);}
else{$("#btnCounterDisabled").hide();$("#btnCounter").css("display","inline").css("text-transform","none");$("#count").hide();clearInterval(countInterval);countInterval=false;$("#count").html(pre_counter_text+"30");}},1000);}
else{if(data.error_type=="not_exist"){$("#error-message-phone-number h5").css('color','red').html("Record not found. Please <a style='color: red;text-transform: none;font-weight: bold;' href="+sign_up_url+">"+"sign up</a> first.");$("#error-message-phone-number").show();$("#error-message-phone-number").delay(4000).fadeOut('slow');}
else{alert("something went wrong!")}}},error:function(xhr,desc,err){stop_full_loader();}});}},unhighlight:function(element,errorClass,validClass){$(element).next('label.error').remove();},errorPlacement:function(error,element){element.after(error);}});$("#otp-submit").validate({rules:{otp:{required:true,number:true},password:{required:true,minlength:8},confirm_password:{required:true,minlength:8,equalTo:"#password"}},submitHandler:function(form){phone_number=ITI_ALL2.getNumber().replace("+","");var otp=$('#otp').val();var password=$('#password').val();var pin_id=$('#pinId').val();var user_id=$('#userId').val();if(phone_number&&otp&&password&&pin_id){start_full_loader();$.ajax({type:"POST",url:otp_submit_url,data:{'csrfmiddlewaretoken':$('#global-csrf-token').val(),'phone_number':phone_number,'otp_code':otp,'otp_secret':pin_id,'password':password,'user_id':user_id,'country_iso2_code':ITI_ALL2.getSelectedCountryData().iso2,},dataType:'json',success:function(data){stop_full_loader();if(data.status){$("#error-message-otp-submit h5").css('color','green').html("Password has been changed successfully");$("#error-message-otp-submit").show();location.replace(location.origin+profile_url);}
else{if(data.errorType=="wrong_otp_code"){$("#error-message-otp-submit h5").css('color','red').html("You have entered wrong OTP. Please try again.");$("#error-message-otp-submit").show();}
else{alert("Something went wrong");}}},error:function(xhr,desc,err){stop_full_loader();}});}},unhighlight:function(element,errorClass,validClass){$(element).next('label.error').remove();},errorPlacement:function(error,element){element.after(error);}});});;